<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TonExpress Audio & Video</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/tonweb@0.0.66/dist/tonweb.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #050510;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #0088cc;
            --gold: #ffd700;
            --danger: #ff4757;
            --warning: #ffa502;
            --success: #2ed573;
            --text-main: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* === –§–û–ù (–í–ò–î–ï–û) === */
        #bg-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -2;
        }
        .video-overlay-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 16, 0.75); backdrop-filter: blur(3px); z-index: -1;
        }

        /* === –ö–ù–û–ü–ö–ê –ó–í–£–ö–ê === */
        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 18px;
        }

        /* === UI === */
        #app {
            padding: 15px; max-width: 450px; margin: 0 auto; width: 100%;
            box-sizing: border-box; height: 100vh; display: flex; flex-direction: column;
            position: relative; z-index: 1;
        }

        .top-section { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }

        .top-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; width: 100%; margin-bottom: 15px; margin-top: 50px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–≤—É–∫–∞ */ }
        .stat-box { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px 4px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .stat-icon { font-size: 14px; margin-bottom: 4px; color: var(--primary); }
        .stat-val { font-weight: 700; font-size: 13px; }
        .stat-label { font-size: 10px; color: #8fa2b3; text-transform: uppercase; margin-top: 2px;}

        .sub-header { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .last-buy { font-size: 12px; color: var(--primary); background: rgba(0, 136, 204, 0.1); padding: 6px 12px; border-radius: 20px; }
        .ref-icon { font-size: 20px; color: var(--gold); cursor: pointer; padding: 5px; }

        .jackpot-container { text-align: center; margin-bottom: 20px; width: 100%; }
        .jackpot-title { font-size: 12px; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; }
        .jackpot-value { font-size: 38px; font-weight: 800; color: #fff; text-shadow: 0 0 20px rgba(255,215,0,0.5); }

        /* –¢–ê–ô–ú–ï–† */
        .timer-box { text-align: center; margin-bottom: 20px; margin-top: 10px; transition: transform 0.3s; }
        .timer-val {
            font-family: 'Courier New', monospace; font-size: 64px; font-weight: 900;
            letter-spacing: -2px; line-height: 1; text-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: color 0.5s ease, text-shadow 0.5s ease;
        }
        .timer-green { color: var(--success); text-shadow: 0 0 20px rgba(46, 213, 115, 0.4); }
        .timer-yellow { color: var(--warning); text-shadow: 0 0 20px rgba(255, 165, 2, 0.4); }
        .timer-red { color: var(--danger); text-shadow: 0 0 30px rgba(255, 71, 87, 0.6); }
        .timer-panic { animation: panicPulse 0.8s infinite alternate; }
        @keyframes panicPulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.05); opacity: 0.8; text-shadow: 0 0 40px red; } }
        .phase-badge { font-size: 12px; text-transform: uppercase; color: #555; letter-spacing: 3px; margin-top: 5px; display: block;}

        /* –ë–ò–õ–ï–¢–´ */
        .bottom-section { margin-top: auto; padding-bottom: 85px; width: 100%; }
        .tickets-label { color: #8fa2b3; font-size: 12px; margin-bottom: 8px; margin-left: 5px; }
        .tickets-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .ticket-slot {
            background: rgba(255,255,255,0.03); border: 1px dashed var(--glass-border);
            border-radius: 12px; height: 90px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: relative;
        }
        .ticket-active { border: 1px solid var(--primary); background: rgba(0, 136, 204, 0.15); box-shadow: 0 0 15px rgba(0,136,204,0.2); }
        .ticket-empty { color: #8fa2b3; font-size: 11px; cursor: pointer; }
        .ticket-empty:active { transform: scale(0.95); background: rgba(255,255,255,0.05); }
        .ticket-val { font-size: 16px; font-weight: bold; color: white; }
        .btn-plus { width: 28px; height: 28px; background: var(--primary); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; margin-bottom: 4px; }

        /* –§–£–¢–ï–† */
        .footer-actions {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(5,5,16,0.95);
            backdrop-filter: blur(10px); padding: 15px; display: flex; gap: 10px; box-sizing: border-box;
            border-top: 1px solid var(--glass-border); z-index: 100;
        }
        .btn-action {
            flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 600; font-size: 12px;
            cursor: pointer; color: white; display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .btn-divs { background: rgba(46, 213, 115, 0.15); color: var(--success); border: 1px solid rgba(46, 213, 115, 0.3); }
        .btn-refund { background: rgba(255, 71, 87, 0.15); color: var(--danger); border: 1px solid rgba(255, 71, 87, 0.3); }
        .btn-val { font-size: 14px; font-weight: 800; }

        /* CONNECT & MODALS */
        #connect-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 16, 0.85); backdrop-filter: blur(5px); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #151a25; border: 1px solid var(--glass-border); width: 85%; padding: 25px; border-radius: 20px; text-align: center; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 20px; font-size: 28px; cursor: pointer; color: #aaa; }

    </style>
</head>
<body>

    <audio id="train-sound" loop>
        <source src="train_sound.mp3" type="audio/mpeg">
    </audio>

    <video autoplay muted loop playsinline id="bg-video">
        <source src="background.mp4" type="video/mp4">
    </video>
    <div class="video-overlay-layer"></div>

    <div class="sound-toggle" onclick="toggleSound()">
        <i class="fas fa-volume-mute" id="sound-icon"></i>
    </div>

    <div id="connect-overlay" onclick="startAudioContext()">
        <h1 style="font-size:32px; margin-bottom:10px;">üöÇ TonExpress</h1>
        <p style="color:#8fa2b3; margin-bottom:30px;">Tap anywhere to connect</p>
        <div id="ton-connect-btn"></div>
    </div>

    <div id="modal-referral" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('modal-referral')">&times;</span>
            <h3>üéÅ Referral Program</h3>
            <p style="font-size:12px; color:#aaa;">Invite friends and earn 5% dividends</p>
            <input type="text" value="https://t.me/TonExpressBot?start=ref" readonly style="width:100%; background:#000; color:#fff; padding:10px; border-radius:8px; border:1px solid #333; text-align:center; margin-top:10px;">
        </div>
    </div>

    <div id="app" onclick="startAudioContext()">
        
        <div class="top-section">
            <div class="top-stats">
                <div class="stat-box"><i class="fas fa-university stat-icon"></i><div class="stat-val">1,250</div><div class="stat-label">Bank</div></div>
                <div class="stat-box"><i class="fas fa-users stat-icon"></i><div class="stat-val" id="players-val">85</div><div class="stat-label">Players</div></div>
                <div class="stat-box"><i class="fas fa-rocket stat-icon"></i><div class="stat-val">500</div><div class="stat-label">Pot</div></div>
            </div>

            <div class="sub-header">
                <div class="last-buy">LAST: 0x8a...4f</div>
                <div class="ref-icon" onclick="openModal('modal-referral')"><i class="fas fa-gift"></i></div>
            </div>

            <div class="jackpot-container">
                <div class="jackpot-title">Top 3 Prize Pool</div>
                <div class="jackpot-value">850 TON</div>
            </div>

            <div class="timer-box">
                <div class="timer-val timer-green" id="main-timer">05:00</div>
                <span class="phase-badge">ROUND ENDS IN</span>
            </div>
        </div>

        <div class="bottom-section">
            <div class="tickets-label">YOUR TICKETS</div>
            <div class="tickets-grid">
                <div class="ticket-slot ticket-active"><div class="ticket-val">0.80</div><div style="font-size:9px; color:#aaa; margin-top:2px;">STAKE</div></div>
                <div class="ticket-slot ticket-empty" onclick="buyTicketAction()"><div class="btn-plus"><i class="fas fa-plus"></i></div><div>BUY</div></div>
                <div class="ticket-slot ticket-empty" onclick="buyTicketAction()"><div class="btn-plus"><i class="fas fa-plus"></i></div><div>BUY</div></div>
            </div>
        </div>
    </div>

    <div class="footer-actions">
        <button class="btn-action btn-divs"><i class="fas fa-coins"></i><div>DIVIDENDS</div><div class="btn-val">0.45</div></button>
        <button class="btn-action btn-refund"><i class="fas fa-life-ring"></i><div>REFUND</div><div class="btn-val">~0.8</div></button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –õ–û–ì–ò–ö–ê –ó–í–£–ö–ê ---
        const audio = document.getElementById('train-sound');
        const soundIcon = document.getElementById('sound-icon');
        let isMuted = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–ø—Ä–∏ –∫–ª–∏–∫–µ)
        function startAudioContext() {
            // –ï—Å–ª–∏ –∑–≤—É–∫ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å
            if (audio.paused && !isMuted) {
                audio.play().catch(e => console.log("Audio waiting for interaction"));
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–≤—É–∫–∞
        function toggleSound() {
            isMuted = !isMuted;
            if (isMuted) {
                audio.pause();
                soundIcon.classList.remove('fa-volume-up');
                soundIcon.classList.add('fa-volume-mute');
                soundIcon.style.color = 'white';
            } else {
                audio.volume = 0.3; // –ì—Ä–æ–º–∫–æ—Å—Ç—å 30% (—á—Ç–æ–±—ã –Ω–µ –æ–≥–ª–æ—Ö–Ω—É—Ç—å)
                audio.play();
                soundIcon.classList.remove('fa-volume-mute');
                soundIcon.classList.add('fa-volume-up');
                soundIcon.style.color = 'var(--primary)';
            }
        }

        // --- –õ–û–ì–ò–ö–ê –¢–ê–ô–ú–ï–†–ê –ò –¶–í–ï–¢–û–í ---
        let activePlayers = 85; 
        let timeLeft = 300;
        const timerEl = document.getElementById('main-timer');

        function updateTimerVisuals() {
            timerEl.classList.remove('timer-green', 'timer-yellow', 'timer-red');
            if (activePlayers < 100) timerEl.classList.add('timer-green');
            else if (activePlayers >= 100 && activePlayers < 200) timerEl.classList.add('timer-yellow');
            else timerEl.classList.add('timer-red');

            if (timeLeft <= 180) timerEl.classList.add('timer-panic');
            else timerEl.classList.remove('timer-panic');
        }

        setInterval(() => {
            if (timeLeft > 0) timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            timerEl.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            updateTimerVisuals();
        }, 1000);

        // --- TON CONNECT ---
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://olia1002k-afk.github.io/game-front/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-btn'
        });

        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                document.getElementById('connect-overlay').style.display = 'none';
                startAudioContext(); // –ü—Ä–æ–±—É–µ–º –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
            } else {
                document.getElementById('connect-overlay').style.display = 'flex';
            }
        });

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function buyTicketAction() { alert("Ticket buy logic..."); }

        updateTimerVisuals();
    </script>
</body>
</html>

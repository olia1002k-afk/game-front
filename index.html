<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TonExpress v4.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/tonweb@0.0.66/dist/tonweb.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #050510;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #0088cc;
            --gold: #ffd700;
            --danger: #ff4757;
            --warning: #ffa502;
            --success: #2ed573;
            --text-main: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1a2035 0%, #050510 100%);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* === –ê–ù–ò–ú–ê–¶–ò–Ø –ü–û–ï–ó–î–ê (–§–û–ù) === */
        .train-bg-container {
            position: absolute;
            top: 40%;
            left: -100%; /* –°—Ç–∞—Ä—Ç—É–µ—Ç –∑–∞ —ç–∫—Ä–∞–Ω–æ–º */
            width: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
            animation: trainMove 12s linear infinite;
            display: flex;
            align-items: center;
        }
        
        .train-icon {
            font-size: 180px;
            color: var(--primary);
            filter: drop-shadow(0 0 20px var(--primary));
        }

        .smoke {
            position: absolute;
            left: 140px;
            top: 20px;
            width: 200px;
            height: 50px;
            background: linear-gradient(to right, rgba(255,255,255,0.2), transparent);
            filter: blur(20px);
        }

        @keyframes trainMove {
            0% { transform: translateX(0vw); }
            100% { transform: translateX(200vw); }
        }

        /* === LAYOUT === */
        #app {
            padding: 15px;
            max-width: 450px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –î–∂–µ–∫–ø–æ—Ç, –¢–∞–π–º–µ—Ä) */
        .top-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 1. Stats Panel */
        .top-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            width: 100%;
            margin-bottom: 15px;
        }
        .stat-box {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px 4px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-icon { font-size: 14px; margin-bottom: 4px; color: var(--primary); }
        .stat-val { font-weight: 700; font-size: 13px; }
        .stat-label { font-size: 10px; color: #8fa2b3; text-transform: uppercase; margin-top: 2px;}

        /* 2. Sub Header */
        .sub-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .last-buy { font-size: 12px; color: var(--primary); background: rgba(0, 136, 204, 0.1); padding: 6px 12px; border-radius: 20px; }
        .ref-icon { font-size: 20px; color: var(--gold); cursor: pointer; padding: 5px; }

        /* 3. Jackpot (Compact) */
        .jackpot-container {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        .jackpot-title { font-size: 12px; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; }
        .jackpot-value { font-size: 38px; font-weight: 800; color: #fff; text-shadow: 0 0 20px rgba(255,215,0,0.5); }

        /* 4. TIMER (HUGE & COLORED) */
        .timer-box {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 10px;
            transition: transform 0.3s;
        }
        
        .timer-val {
            font-family: 'Courier New', monospace; /* –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π –¥–ª—è —Ü–∏—Ñ—Ä */
            font-size: 64px; /* –û–ß–ï–ù–¨ –ë–û–õ–¨–®–û–ô */
            font-weight: 900;
            letter-spacing: -2px;
            line-height: 1;
            text-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: color 0.5s ease, text-shadow 0.5s ease;
        }

        /* –¶–≤–µ—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ */
        .timer-green { color: var(--success); text-shadow: 0 0 20px rgba(46, 213, 115, 0.4); }
        .timer-yellow { color: var(--warning); text-shadow: 0 0 20px rgba(255, 165, 2, 0.4); }
        .timer-red { color: var(--danger); text-shadow: 0 0 30px rgba(255, 71, 87, 0.6); }

        /* –ü—É–ª—å—Å–∞—Ü–∏—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–∏–Ω—É—Ç—ã) */
        .timer-panic {
            animation: panicPulse 0.8s infinite alternate;
        }
        @keyframes panicPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.05); opacity: 0.8; text-shadow: 0 0 40px red; }
        }

        .phase-badge { font-size: 12px; text-transform: uppercase; color: #555; letter-spacing: 3px; margin-top: 5px; display: block;}

        /* 5. Tickets (Bottom Section) */
        .bottom-section {
            margin-top: auto; /* –ü—Ä–∏–∂–∏–º–∞–µ—Ç –∫ –Ω–∏–∑—É */
            padding-bottom: 85px; /* –ú–µ—Å—Ç–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ—É—Ç–µ—Ä–∞ */
            width: 100%;
        }

        .tickets-label { color: #8fa2b3; font-size: 12px; margin-bottom: 8px; margin-left: 5px; }

        .tickets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .ticket-slot {
            background: rgba(255,255,255,0.03);
            border: 1px dashed var(--glass-border);
            border-radius: 12px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .ticket-active { border: 1px solid var(--primary); background: rgba(0, 136, 204, 0.15); box-shadow: 0 0 15px rgba(0,136,204,0.2); }
        .ticket-empty { color: #8fa2b3; font-size: 11px; cursor: pointer; }
        .ticket-empty:active { transform: scale(0.95); background: rgba(255,255,255,0.05); }
        
        .ticket-val { font-size: 16px; font-weight: bold; color: white; }
        .btn-plus { width: 28px; height: 28px; background: var(--primary); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; margin-bottom: 4px; }

        /* 6. Footer Buttons (Fixed) */
        .footer-actions {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: rgba(5,5,16,0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            display: flex;
            gap: 10px;
            box-sizing: border-box;
            border-top: 1px solid var(--glass-border);
            z-index: 100;
        }

        .btn-action {
            flex: 1; padding: 12px; border: none; border-radius: 12px;
            font-weight: 600; font-size: 12px; cursor: pointer; color: white;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .btn-divs { background: rgba(46, 213, 115, 0.15); color: var(--success); border: 1px solid rgba(46, 213, 115, 0.3); }
        .btn-refund { background: rgba(255, 71, 87, 0.15); color: var(--danger); border: 1px solid rgba(255, 71, 87, 0.3); }
        .btn-val { font-size: 14px; font-weight: 800; }

        /* Connect Overlay */
        #connect-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 16, 0.98); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #151a25; border: 1px solid var(--glass-border); width: 85%; padding: 25px; border-radius: 20px; text-align: center; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 20px; font-size: 28px; cursor: pointer; color: #aaa; }

    </style>
</head>
<body>

    <div class="train-bg-container">
        <div class="smoke"></div>
        <i class="fas fa-train-subway train-icon"></i>
    </div>

    <div id="connect-overlay">
        <h1 style="font-size:32px; margin-bottom:10px;">üöÇ TonExpress</h1>
        <p style="color:#8fa2b3; margin-bottom:30px;">Connect wallet to enter the game</p>
        <div id="ton-connect-btn"></div>
    </div>

    <div id="modal-referral" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('modal-referral')">&times;</span>
            <h3>üéÅ Referral Program</h3>
            <p style="font-size:12px; color:#aaa;">Invite friends and earn 5% dividends</p>
            <input type="text" value="https://t.me/TonExpressBot?start=ref" readonly style="width:100%; background:#000; color:#fff; padding:10px; border-radius:8px; border:1px solid #333; text-align:center; margin-top:10px;">
        </div>
    </div>

    <div id="app">
        
        <div class="top-section">
            <div class="top-stats">
                <div class="stat-box">
                    <i class="fas fa-university stat-icon"></i>
                    <div class="stat-val">1,250</div>
                    <div class="stat-label">Bank</div>
                </div>
                <div class="stat-box">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-val" id="players-val">85</div> <div class="stat-label">Players</div>
                </div>
                <div class="stat-box">
                    <i class="fas fa-rocket stat-icon"></i>
                    <div class="stat-val">500</div>
                    <div class="stat-label">Pot</div>
                </div>
            </div>

            <div class="sub-header">
                <div class="last-buy">LAST: 0x8a...4f</div>
                <div class="ref-icon" onclick="openModal('modal-referral')"><i class="fas fa-gift"></i></div>
            </div>

            <div class="jackpot-container">
                <div class="jackpot-title">Top 3 Prize Pool</div>
                <div class="jackpot-value">850 TON</div>
            </div>

            <div class="timer-box">
                <div class="timer-val timer-green" id="main-timer">05:00</div>
                <span class="phase-badge">ROUND ENDS IN</span>
            </div>
        </div>

        <div class="bottom-section">
            <div class="tickets-label">YOUR TICKETS</div>
            <div class="tickets-grid">
                <div class="ticket-slot ticket-active">
                    <div class="ticket-val">0.80</div>
                    <div style="font-size:9px; color:#aaa; margin-top:2px;">STAKE</div>
                </div>
                <div class="ticket-slot ticket-empty" onclick="buyTicketAction()">
                    <div class="btn-plus"><i class="fas fa-plus"></i></div>
                    <div>BUY</div>
                </div>
                <div class="ticket-slot ticket-empty" onclick="buyTicketAction()">
                    <div class="btn-plus"><i class="fas fa-plus"></i></div>
                    <div>BUY</div>
                </div>
            </div>
        </div>

    </div>

    <div class="footer-actions">
        <button class="btn-action btn-divs">
            <i class="fas fa-coins"></i>
            <div>DIVIDENDS</div>
            <div class="btn-val">0.45</div>
        </button>
        <button class="btn-action btn-refund">
            <i class="fas fa-life-ring"></i>
            <div>REFUND</div>
            <div class="btn-val">~0.8</div>
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –õ–û–ì–ò–ö–ê –¢–ê–ô–ú–ï–†–ê –ò –¶–í–ï–¢–û–í ---
        // –ò–º–∏—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)
        let activePlayers = 85; // –ü–æ–ø—Ä–æ–±—É–π –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ 150 –∏–ª–∏ 250, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–≤–µ—Ç
        let timeLeft = 300; // 5 –º–∏–Ω—É—Ç (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const timerEl = document.getElementById('main-timer');
        const playersEl = document.getElementById('players-val');

        function updateTimerVisuals() {
            // 1. –õ–æ–≥–∏–∫–∞ —Ü–≤–µ—Ç–∞ –æ—Ç –ò–ì–†–û–ö–û–í (–¢–ó: 0-100 –ó–µ–ª–µ–Ω—ã–π, 100-200 –ñ–µ–ª—Ç—ã–π, 200+ –ö—Ä–∞—Å–Ω—ã–π)
            timerEl.classList.remove('timer-green', 'timer-yellow', 'timer-red');
            
            if (activePlayers < 100) {
                timerEl.classList.add('timer-green');
            } else if (activePlayers >= 100 && activePlayers < 200) {
                timerEl.classList.add('timer-yellow');
            } else {
                timerEl.classList.add('timer-red');
            }

            // 2. –õ–æ–≥–∏–∫–∞ –ø—É–ª—å—Å–∞—Ü–∏–∏ –æ—Ç –í–†–ï–ú–ï–ù–ò (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–∏–Ω—É—Ç—ã = 180 —Å–µ–∫)
            if (timeLeft <= 180) {
                timerEl.classList.add('timer-panic');
                // –ï—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏–º –∫—Ä–∞—Å–Ω—ã–π
                timerEl.style.color = 'var(--danger)'; 
            } else {
                timerEl.classList.remove('timer-panic');
            }
        }

        // –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        setInterval(() => {
            if (timeLeft > 0) timeLeft--;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 00:00
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            timerEl.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            updateTimerVisuals();

            // –î–µ–º–æ: –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –¥–æ–±–∞–≤–ª—è–µ–º "–∏–≥—Ä–æ–∫–∞", —á—Ç–æ–±—ã —Ç—ã —É–≤–∏–¥–µ–ª —Å–º–µ–Ω—É —Ü–≤–µ—Ç–∞
            // (–£–¥–∞–ª–∏ —ç—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ)
            // if (timeLeft % 10 === 0) { 
            //     activePlayers += 20; 
            //     playersEl.innerText = activePlayers;
            // }

        }, 1000);

        // --- TON CONNECT ---
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://olia1002k-afk.github.io/game-front/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-btn'
        });

        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                document.getElementById('connect-overlay').style.display = 'none';
            } else {
                document.getElementById('connect-overlay').style.display = 'flex';
            }
        });

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function buyTicketAction() { alert("Ticket buy logic..."); }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        playersEl.innerText = activePlayers;
        updateTimerVisuals();

    </script>
</body>
</html>

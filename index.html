<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TonExpress Neon & Timer</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/tonweb@0.0.66/dist/tonweb.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #050510;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #0088cc;
            --gold: #ffd700;
            --danger: #ff4757;
            --warning: #ffa502;
            --success: #2ed573;
            --text-main: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* === –§–û–ù (–í–ò–î–ï–û) === */
        #bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -5; }
        .video-overlay-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 16, 0.85); backdrop-filter: blur(5px); z-index: -4; }

        /* === UI ELEMENTS === */
        .sound-toggle { position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 50; font-size: 16px; }
        
        .wallet-panel { position: absolute; top: 15px; left: 15px; display: flex; align-items: center; gap: 8px; z-index: 50; }
        .wallet-address-box { background: rgba(0, 136, 204, 0.2); border: 1px solid rgba(0, 136, 204, 0.3); border-radius: 20px; padding: 6px 12px; font-size: 12px; font-weight: bold; color: #fff; font-family: monospace; display: flex; align-items: center; gap: 6px; }
        .btn-disconnect { background: rgba(255, 71, 87, 0.2); border: 1px solid rgba(255, 71, 87, 0.3); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; color: var(--danger); cursor: pointer; font-size: 14px; }

        #connect-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 16, 0.98); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        #app { padding: 15px; max-width: 450px; margin: 0 auto; width: 100%; box-sizing: border-box; height: 100vh; display: flex; flex-direction: column; position: relative; z-index: 1; }

        .top-section { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        .top-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; width: 100%; margin-bottom: 15px; margin-top: 60px; }
        .stat-box { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px 4px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .stat-icon { font-size: 14px; margin-bottom: 4px; color: var(--primary); }
        .stat-val { font-weight: 700; font-size: 13px; }
        .stat-label { font-size: 10px; color: #8fa2b3; text-transform: uppercase; margin-top: 2px;}

        .sub-header { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .last-buy { font-size: 12px; color: var(--primary); background: rgba(0, 136, 204, 0.1); padding: 6px 12px; border-radius: 20px; }
        .ref-icon { font-size: 20px; color: var(--gold); cursor: pointer; padding: 5px; }

        /* === üî• –ù–û–í–´–ô –°–¢–ò–õ–¨ JACKPOT üî• === */
        .jackpot-container { text-align: center; margin-bottom: 20px; width: 100%; }
        .jackpot-title { 
            font-size: 28px; /* –ö—Ä—É–ø–Ω–µ–µ */
            font-weight: 900;
            color: #fff; /* –ë–µ–ª—ã–π —Ü–µ–Ω—Ç—Ä */
            text-transform: uppercase; 
            letter-spacing: 3px;
            margin-bottom: 5px;
            /* –ù–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ (–æ—Ä–∞–Ω–∂–µ–≤–æ-–∑–æ–ª–æ—Ç–æ–µ) */
            text-shadow: 
                0 0 5px #fff,
                0 0 10px var(--warning),
                0 0 20px var(--warning),
                0 0 40px var(--warning),
                0 0 60px var(--danger);
        }
        .jackpot-value { font-size: 38px; font-weight: 800; color: #fff; text-shadow: 0 0 20px rgba(255,215,0,0.5); }

        /* === üî• –°–¢–ò–õ–ò –¢–ê–ô–ú–ï–†–ê –ò –ü–ê–ù–ò–ö–ò üî• === */
        .timer-box { text-align: center; margin-bottom: 20px; margin-top: 10px; }
        .timer-val { 
            font-family: 'Courier New', monospace; font-size: 64px; font-weight: 900; letter-spacing: -2px; line-height: 1; 
            transition: color 0.5s ease, text-shadow 0.5s ease, transform 0.5s ease; /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        }
        /* –¶–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–≥—Ä–æ–∫–æ–≤ */
        .timer-green { color: var(--success); text-shadow: 0 0 20px rgba(46, 213, 115, 0.4); }
        .timer-yellow { color: var(--warning); text-shadow: 0 0 25px rgba(255, 165, 2, 0.5); }
        .timer-red { color: var(--danger); text-shadow: 0 0 30px rgba(255, 71, 87, 0.6); }
        
        /* –†–µ–∂–∏–º –ü–ê–ù–ò–ö–ò (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–∏–Ω—É—Ç—ã) - –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
        .timer-panic {
            color: var(--danger) !important; /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∞—Å–Ω—ã–π */
            text-shadow: 0 0 30px var(--danger), 0 0 50px red !important;
            animation: panicPulse 0.8s infinite alternate; /* –ü—É–ª—å—Å–∞—Ü–∏—è */
        }
        @keyframes panicPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.05); opacity: 0.8; }
        }

        .phase-badge { font-size: 12px; text-transform: uppercase; color: #555; letter-spacing: 3px; margin-top: 5px; display: block;}

        /* –ë–ò–õ–ï–¢–´ –ò –§–£–¢–ï–† */
        .bottom-section { margin-top: auto; padding-bottom: 95px; width: 100%; }
        .tickets-label { color: #8fa2b3; font-size: 12px; margin-bottom: 10px; margin-left: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .tickets-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .ticket-slot { position: relative; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; mask-image: radial-gradient(circle at 0 50%, transparent 8px, black 8.5px), radial-gradient(circle at 100% 50%, transparent 8px, black 8.5px); -webkit-mask-image: radial-gradient(circle at 0 50%, transparent 8px, black 8.5px), radial-gradient(circle at 100% 50%, transparent 8px, black 8.5px); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); }
        .ticket-active { background: linear-gradient(135deg, #0088cc, #005f8f); border: 1px solid rgba(255,255,255,0.2); }
        .ticket-header { font-size: 8px; font-weight: bold; letter-spacing: 1px; background: rgba(0,0,0,0.2); width: 100%; text-align: center; padding: 4px 0; position: absolute; top: 0; }
        .ticket-body { display: flex; flex-direction: column; align-items: center; margin-top: 10px; }
        .ticket-price { font-size: 20px; font-weight: 800; font-family: 'Courier New', monospace; margin-bottom: 4px; }
        .ticket-lock-timer { background: rgba(0,0,0,0.4); border-radius: 4px; padding: 2px 6px; display: flex; align-items: center; gap: 4px; margin-top: 4px; }
        .lock-icon { font-size: 10px; color: rgba(255,255,255,0.7); }
        .lock-time { font-family: 'Courier New', monospace; font-size: 12px; font-weight: bold; color: #fff; }
        .ticket-empty { background: rgba(255,255,255,0.02); border: 1px dashed rgba(255,255,255,0.2); color: #555; cursor: pointer; }
        .btn-plus-icon { font-size: 24px; color: var(--primary); margin-bottom: 5px; }

        .footer-actions { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(5,5,16,0.95); backdrop-filter: blur(10px); padding: 15px; display: flex; gap: 10px; box-sizing: border-box; border-top: 1px solid var(--glass-border); z-index: 50; }
        .btn-action { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 600; font-size: 12px; cursor: pointer; color: white; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .btn-divs { background: rgba(46, 213, 115, 0.15); color: var(--success); border: 1px solid rgba(46, 213, 115, 0.3); }
        .btn-refund { background: rgba(255, 71, 87, 0.15); color: var(--danger); border: 1px solid rgba(255, 71, 87, 0.3); }
        .btn-val { font-size: 14px; font-weight: 800; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #151a25; border: 1px solid var(--glass-border); width: 85%; padding: 25px; border-radius: 20px; text-align: center; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 20px; font-size: 28px; cursor: pointer; color: #aaa; }

    </style>
</head>
<body>

    <audio id="train-sound" loop><source src="train_sound.mp3" type="audio/mpeg"></audio>
    <video autoplay muted loop playsinline id="bg-video"><source src="background.mp4" type="video/mp4"></video>
    <div class="video-overlay-layer"></div>

    <div class="sound-toggle" onclick="toggleSound()"><i class="fas fa-volume-mute" id="sound-icon"></i></div>

    <div id="connect-overlay">
        <h1 style="font-size:32px; margin-bottom:10px;">üöÇ TonExpress</h1>
        <p style="color:#8fa2b3; margin-bottom:30px;">Connect wallet to enter</p>
        <div id="ton-connect-btn"></div>
    </div>

    <div id="modal-referral" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('modal-referral')">&times;</span>
            <h3>üéÅ Referral Program</h3>
            <p style="font-size:12px; color:#aaa;">Invite friends and earn 5% dividends</p>
            <input type="text" value="https://t.me/TonExpressBot?start=ref" readonly style="width:100%; background:#000; color:#fff; padding:10px; border-radius:8px; border:1px solid #333; text-align:center; margin-top:10px;">
        </div>
    </div>

    <div id="app" onclick="startAudioContext()">
        
        <div class="wallet-panel" id="wallet-panel" style="display:none;">
            <div class="wallet-address-box"><i class="fas fa-wallet"></i><span id="wallet-address-text">...</span></div>
            <div class="btn-disconnect" onclick="disconnectWallet()"><i class="fas fa-sign-out-alt"></i></div>
        </div>

        <div class="top-section">
            <div class="top-stats">
                <div class="stat-box"><i class="fas fa-university stat-icon"></i><div class="stat-val">1,250</div><div class="stat-label">Bank</div></div>
                <div class="stat-box"><i class="fas fa-users stat-icon"></i><div class="stat-val" id="players-val">85</div><div class="stat-label">Players</div></div>
                <div class="stat-box"><i class="fas fa-rocket stat-icon"></i><div class="stat-val">500</div><div class="stat-label">Pot</div></div>
            </div>

            <div class="sub-header">
                <div class="last-buy">LAST: 0x8a...4f</div>
                <div class="ref-icon" onclick="openModal('modal-referral')"><i class="fas fa-gift"></i></div>
            </div>

            <div class="jackpot-container">
                <div class="jackpot-title">JackPot</div>
                <div class="jackpot-value">850 TON</div>
            </div>

            <div class="timer-box">
                <div class="timer-val" id="main-timer">05:00</div>
                <span class="phase-badge" id="phase-text">ROUND ENDS IN</span>
            </div>
        </div>

        <div class="bottom-section">
            <div class="tickets-label">YOUR TICKETS</div>
            <div class="tickets-grid">
                <div class="ticket-slot ticket-active">
                    <div class="ticket-header">TON EXPRESS</div>
                    <div class="ticket-body">
                        <div style="font-size:8px; opacity:0.8;">STAKE</div>
                        <div class="ticket-price">0.80</div>
                        <div class="ticket-lock-timer">
                            <i class="fas fa-lock lock-icon"></i>
                            <span class="lock-time" id="ticket-timer-1">10:00</span>
                        </div>
                    </div>
                </div>
                <div class="ticket-slot ticket-empty" onclick="alert('Buy Logic')">
                    <i class="fas fa-plus-circle btn-plus-icon"></i>
                    <div style="font-size:10px; font-weight:bold;">BUY TICKET</div>
                    <div style="font-size:9px; color:#666;">1 TON</div>
                </div>
                <div class="ticket-slot ticket-empty" onclick="alert('Buy Logic')">
                    <i class="fas fa-plus-circle btn-plus-icon"></i>
                    <div style="font-size:10px; font-weight:bold;">BUY TICKET</div>
                    <div style="font-size:9px; color:#666;">1 TON</div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-actions">
        <button class="btn-action btn-divs"><i class="fas fa-coins"></i><div>DIVIDENDS</div><div class="btn-val">0.45</div></button>
        <button class="btn-action btn-refund"><i class="fas fa-life-ring"></i><div>REFUND</div><div class="btn-val">~0.8</div></button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ó–í–£–ö ---
        const audio = document.getElementById('train-sound');
        const soundIcon = document.getElementById('sound-icon');
        let isMuted = true; 
        function startAudioContext() { if (audio.paused && !isMuted) { audio.play().catch(e => console.log("Audio waiting")); } }
        function toggleSound() {
            isMuted = !isMuted;
            if (isMuted) { audio.pause(); soundIcon.classList.replace('fa-volume-up', 'fa-volume-mute'); soundIcon.style.color = 'white'; } 
            else { audio.volume = 0.3; audio.play(); soundIcon.classList.replace('fa-volume-mute', 'fa-volume-up'); soundIcon.style.color = 'var(--primary)'; }
        }

        // --- üî• –ì–õ–ê–í–ù–´–ô –¢–ê–ô–ú–ï–† –ò –õ–û–ì–ò–ö–ê –¶–í–ï–¢–û–í üî• ---
        // –î–ê–ù–ù–´–ï –î–õ–Ø –¢–ï–°–¢–ê (–ü–æ–º–µ–Ω—è–π –∏—Ö, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞!)
        let activePlayers = 85;  // –ü–æ–ø—Ä–æ–±—É–π: 150 (–∂–µ–ª—Ç—ã–π), 250 (–∫—Ä–∞—Å–Ω—ã–π)
        let timeLeft = 300;      // –ü–æ–ø—Ä–æ–±—É–π: 170 (—Ä–µ–∂–∏–º –ø–∞–Ω–∏–∫–∏!)

        const timerEl = document.getElementById('main-timer');
        const phaseTextEl = document.getElementById('phase-text');
        const playersValEl = document.getElementById('players-val');

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∞ —Ç–∞–π–º–µ—Ä–∞
        function updateTimerVisuals() {
            // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã
            timerEl.classList.remove('timer-green', 'timer-yellow', 'timer-red', 'timer-panic');

            // 1. –õ–æ–≥–∏–∫–∞ –ø–æ –ò–ì–†–û–ö–ê–ú
            if (activePlayers < 100) {
                timerEl.classList.add('timer-green');
            } else if (activePlayers >= 100 && activePlayers < 200) {
                timerEl.classList.add('timer-yellow');
            } else {
                timerEl.classList.add('timer-red');
            }

            // 2. –õ–æ–≥–∏–∫–∞ –ø–æ –í–†–ï–ú–ï–ù–ò (–ü–∞–Ω–∏–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–∏–Ω—É—Ç—ã = 180 —Å–µ–∫)
            // –≠—Ç–æ—Ç —Ä–µ–∂–∏–º –ü–ï–†–ï–ö–†–´–í–ê–ï–¢ —Ü–≤–µ—Ç –æ—Ç –∏–≥—Ä–æ–∫–æ–≤
            if (timeLeft <= 180) {
                 timerEl.classList.add('timer-panic');
                 phaseTextEl.innerText = "‚ö†Ô∏è TRAIN DESTRUCTION IMMINENT ‚ö†Ô∏è";
                 phaseTextEl.style.color = "var(--danger)";
            } else {
                 phaseTextEl.innerText = "ROUND ENDS IN";
                 phaseTextEl.style.color = "#555";
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∏—Å–ª–æ –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            playersValEl.innerText = activePlayers;
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ç–∞–π–º–µ—Ä–∞
        setInterval(() => {
            if (timeLeft > 0) timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            timerEl.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            updateTimerVisuals();
        }, 1000);


        // --- –¢–ê–ô–ú–ï–† –ë–ò–õ–ï–¢–ê ---
        let ticketLockTime = 600;
        const ticketTimerEl = document.getElementById('ticket-timer-1');
        setInterval(() => {
            if (ticketLockTime > 0) {
                ticketLockTime--;
                const tm = Math.floor(ticketLockTime / 60);
                const ts = ticketLockTime % 60;
                ticketTimerEl.innerText = `${tm < 10 ? '0'+tm : tm}:${ts < 10 ? '0'+ts : ts}`;
            } else { ticketTimerEl.innerText = "UNLOCKED"; ticketTimerEl.style.color = "var(--success)"; }
        }, 1000);

        // --- TON CONNECT LOGIC ---
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://olia1002k-afk.github.io/game-front/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-btn'
        });

        function safeFormatAddress(address) {
            if (window.TonWeb) {
                try {
                    const userFriendly = new TonWeb.utils.Address(address).toString(true, true, true);
                    return userFriendly.slice(0, 4) + '...' + userFriendly.slice(-4);
                } catch (e) { console.error(e); }
            }
            return address.slice(0, 6) + '...';
        }

        function updateWalletUI(wallet) {
            const overlay = document.getElementById('connect-overlay');
            const panel = document.getElementById('wallet-panel');
            const addrText = document.getElementById('wallet-address-text');

            if (wallet) {
                overlay.style.setProperty('display', 'none', 'important');
                panel.style.display = 'flex';
                if (wallet.account && wallet.account.address) {
                    addrText.innerText = safeFormatAddress(wallet.account.address);
                }
                startAudioContext();
            } else {
                overlay.style.display = 'flex';
                panel.style.display = 'none';
            }
        }

        tonConnectUI.onStatusChange(wallet => updateWalletUI(wallet));
        setTimeout(() => { if (tonConnectUI.wallet) updateWalletUI(tonConnectUI.wallet); }, 500);
        async function disconnectWallet() { await tonConnectUI.disconnect(); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        updateTimerVisuals();
    </script>
</body>
</html>
